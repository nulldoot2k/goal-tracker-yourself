{% extends "base.html" %}

{% block title %}Ti·∫øn ƒê·ªô{% endblock %}

{% block content %}
<div class="container-fluid">
    <h2 class="mb-4"><i class="bi bi-graph-up-arrow"></i> Ti·∫øn ƒê·ªô M·ª•c Ti√™u</h2>

    <!-- TI·∫æN ƒê·ªò TU·∫¶N -->
    <div class="card goal-card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="bi bi-calendar-week"></i> Ti·∫øn ƒê·ªô Tu·∫ßn N√†y</h5>
                <span class="badge bg-primary">{{ week_range }}</span>
            </div>

            {% if week_stats.total_activities > 0 %}
                <!-- T·ªïng quan tu·∫ßn -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ week_stats.total_activities }}</h3>
                            <small>Ho·∫°t ƒë·ªông tu·∫ßn n√†y</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ week_stats.active_goals }}</h3>
                            <small>M·ª•c ti√™u ƒëang l√†m</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ week_stats.avg_per_day }}</h3>
                            <small>Ho·∫°t ƒë·ªông/ng√†y</small>
                        </div>
                    </div>
                </div>

                <!-- Chi ti·∫øt theo m·ª•c ti√™u -->
                <h6 class="mb-3">Chi Ti·∫øt Theo M·ª•c Ti√™u</h6>
                {% for goal_id, info in week_by_goal.items() %}
                <div class="card mb-3" style="background: #f8f9fa; border: 2px solid #dee2e6;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">
                                <i class="bi bi-bullseye text-primary"></i> 
                                {{ info.goal_title }}
                            </h6>
                            <span class="badge bg-success">{{ info.tasks|length }} ho·∫°t ƒë·ªông</span>
                        </div>
                        
                        <div class="mt-2">
                            {% for task in info.tasks %}
                            <div class="d-flex justify-content-between align-items-center py-1 border-bottom">
                                <span>
                                    <i class="bi bi-check-circle-fill text-success"></i>
                                    {{ task.title }}
                                </span>
                                <small class="text-muted">{{ task.created_at }}</small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-secondary alert-custom">
                    <i class="bi bi-info-circle"></i> 
                    Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o trong tu·∫ßn n√†y. H√£y b·∫Øt ƒë·∫ßu l√†m vi·ªác!
                </div>
            {% endif %}
        </div>
    </div>

    <!-- TI·∫æN ƒê·ªò TH√ÅNG -->
    <div class="card goal-card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="bi bi-calendar-month"></i> Ti·∫øn ƒê·ªô Th√°ng {{ month_name }}</h5>
            </div>

            {% if month_stats.total_activities > 0 %}
                <!-- T·ªïng quan th√°ng -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ month_stats.total_activities }}</h3>
                            <small>T·ªïng ho·∫°t ƒë·ªông</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ month_stats.active_goals }}</h3>
                            <small>M·ª•c ti√™u ƒëang l√†m</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ month_stats.completed_goals }}</h3>
                            <small>Ho√†n th√†nh</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center">
                            <h3 class="mb-1">{{ month_stats.days_active }}</h3>
                            <small>Ng√†y l√†m vi·ªác</small>
                        </div>
                    </div>
                </div>

                <!-- Bi·ªÉu ƒë·ªì theo m·ª•c ti√™u -->
                <h6 class="mb-3">Ph√¢n B·ªë Theo M·ª•c Ti√™u</h6>
                <div class="row">
                    {% for goal_id, info in month_by_goal.items() %}
                    <div class="col-md-6 mb-3">
                        <div class="card" style="background: #f8f9fa; border: 2px solid #dee2e6;">
                            <div class="card-body">
                                <h6 class="mb-2">
                                    <i class="bi bi-bullseye text-primary"></i> 
                                    {{ info.goal_title }}
                                </h6>
                                
                                <div class="d-flex justify-content-between mb-2">
                                    <span><strong>S·ªë ho·∫°t ƒë·ªông:</strong></span>
                                    <span class="badge bg-primary">{{ info.tasks|length }}</span>
                                </div>
                                
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar progress-bar-custom" 
                                         style="width: {{ (info.tasks|length / month_stats.total_activities * 100)|round }}%;">
                                    </div>
                                </div>
                                
                                <small class="text-muted mt-2 d-block">
                                    <i class="bi bi-percent"></i>
                                    {{ (info.tasks|length / month_stats.total_activities * 100)|round(1) }}% t·ªïng ho·∫°t ƒë·ªông
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-secondary alert-custom">
                    <i class="bi bi-info-circle"></i> 
                    Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o trong th√°ng n√†y.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Ghi ch√∫ -->
    <div class="alert alert-info alert-custom mt-4">
        <i class="bi bi-lightbulb"></i> <strong>L∆∞u √Ω:</strong> 
        Ti·∫øn ƒë·ªô ƒë∆∞·ª£c t√≠nh t·ª± ƒë·ªông d·ª±a tr√™n s·ªë l∆∞·ª£ng ho·∫°t ƒë·ªông b·∫°n ƒë√£ t·∫°o. 
        C√†ng nhi·ªÅu ho·∫°t ƒë·ªông = C√†ng ti·∫øn b·ªô! üí™
    </div>
</div>
{% endblock %}
